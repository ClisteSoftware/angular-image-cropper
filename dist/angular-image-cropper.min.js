!function(t){"use strict";t.module("imageCropper",[])}(angular),function(t){"use strict";t.module("imageCropper").constant("defaultConfig",{width:400,height:300,zoomStep:.1,init:null,showControls:!0,fitOnInit:!0,restrictSize:!1})}(angular),function(t){"use strict";function e(t){function e(t){return r.test(t.type)}function i(t){return e(t)?1===t.originalEvent.changedTouches.length:1===t.which}function n(t){return e(t)&&(t=t.originalEvent.touches[0]),{x:t.pageX,y:t.pageY}}function o(){if(null!==a)return a;var t,e,i,n,o,r,l,s,u;for(i=["webkit","Moz","O","ms","Khtml"],r={transform:"transform"},s=0,u=i.length;u>s;s++)e=i[s],r[e+"Transform"]="-"+e.toLowerCase()+"-transform";t=document.createElement("img"),document.body.insertBefore(t,null);for(o in r)if(n=r[o],void 0!==t.style[o]&&(t.style[o]="rotate(90deg)",l=window.getComputedStyle(t).getPropertyValue(n),null!==l&&l.length&&"none"!==l)){a=!0;break}return document.body.removeChild(t),a}var r=/touch/i,a=null,l={canTransform:o,getPointerPosition:n,isTouch:e,validEvent:i};return l}t.module("imageCropper").factory("Helper",e),e.$inject=["defaultConfig"]}(angular),function(t){"use strict";function e(t,e){function i(t,i,o,u){return r=document.createElement("canvas"),r.width=o,r.height=u,a=r.getContext("2d"),a.fillStyle="white",a.beginPath(),a.fillStyle="white",a.moveTo(0,0),a.lineTo(o,0),a.lineTo(o,u),a.lineTo(0,u),a.lineTo(0,0),a.stroke(),a.fill(),s=i,c=e.defer(),l=new Image,l.src=t.src,l.onload=n,c.promise}function n(){return a.save(),a.scale(s.scale,s.scale),a.rotate(s.angle*Math.PI/180),90===s.angle?(a.translate(0,-l.height),a.translate(-s.y/s.scale,s.x/s.scale)):180===s.angle?(a.translate(-l.width,-l.height),a.translate(s.x/s.scale,s.y/s.scale)):270===s.angle?(a.translate(-l.width,0),a.translate(s.y/s.scale,-s.x/s.scale)):a.translate(-s.x/s.scale,-s.y/s.scale),a.drawImage(l,0,0),a.restore(),u=r.toDataURL("image/jpeg"),c.resolve(u)}function o(){return u}var r,a,l,s,u,c,g={crop:i,get:o};return g}t.module("imageCropper").factory("Cropper",e),e.$inject=["Helper","$q"]}(angular),function(t){"use strict";function e(e,i,n){function o(o,r,a){var l=!1,s=t.element("body"),u=r.find("img"),c=r.find(".imgCropper-canvas"),g=r.find(".imgCropper-window"),h={};h.width=Number(o.destWidth)||i.width,h.height=Number(o.destHeight)||i.height,h.zoomStep=Number(o.zoomStep)||i.zoomStep,h.init=o.init||i.init,h.fitOnInit=o.fitOnInit||i.fitOnInit,h.restrictSize=o.restrictSize||i.restrictSize;var d,f,m,p,v,y=1+h.zoomStep,w=1/y,b=h.height/h.width;d=f=m=p=v=0;var C,z={scale:1,angle:0,x:0,y:0,w:h.width,h:h.height},x={start:"touchstart mousedown",move:"touchmove mousemove",stop:"touchend mouseup"},S=function(){d=u[0].naturalWidth/h.width,f=u[0].naturalHeight/h.height,c.css({width:100*d+"%",height:100*f+"%",top:0,left:0}),g.css({width:"100%",height:"auto","padding-top":h.height/h.width*100+"%"}),l=!0},I=function(t){return l&&n.validEvent(t)?(t.preventDefault(),t.stopImmediatePropagation(),C=n.getPointerPosition(t),k()):void 0},k=function(){return s.addClass("imgCropper-dragging"),c.on(x.move,O),c.on(x.stop,P)},P=function(t){s.removeClass("imgCropper-dragging"),c.off(x.move,O),c.off(x.stop,P)},T=function(t,e){if(!(0>t&&h.restrictSize)){if(t||0===t){var i=1;0>t&&(i=.5,t=0),t>d-1&&(t=d-1),c[0].style.left=(-t*i*100).toFixed(2)+"%",m=t*i,z.x=Math.round(t*i*h.width)}if(e||0===e){var n=1;0>e&&(n=.5,e=0),e>f-1&&(e=f-1),c[0].style.top=(-e*n*100).toFixed(2)+"%",p=e*n,z.y=Math.round(e*n*h.height)}return R()}},O=function(t){var e,i,o,r,a;return t.preventDefault(),t.stopImmediatePropagation(),r=n.getPointerPosition(t),e=r.x-C.x,i=r.y-C.y,C=r,o=0===e?null:m-e/g[0].clientWidth,a=0===i?null:p-i/g[0].clientHeight,T(o,a)},H=function(t){var e,i,n,o;if(!(0>=t||1===t))return o=d,e=f,(1>o*t||1>e*t)&&h.restrictSize?(E(),t=d/o):(d*=t,f*=t,c[0].style.width=(100*d).toFixed(2)+"%",c[0].style.height=(100*f).toFixed(2)+"%",z.scale*=t),i=(m+.5)*t-.5,n=(p+.5)*t-.5,T(i,n)},E=function(){var t,e;return t=d,e=f/d,e>1?(d=1,f=e):(d=1/e,f=1),c[0].style.width=(100*d).toFixed(2)+"%",c[0].style.height=(100*f).toFixed(2)+"%",z.scale*=d/t,R()},F=function(){return T((d-1)/2,(f-1)/2)},j=function(t){var e,i,o,r,a,l;if(n.canTransform()&&0!==t&&t%90===0)return v=(v+t)%360,0>v&&(v=360+v),t%180!==0&&(r=[f*b,d/b],d=r[0],f=r[1],d>=1&&f>=1?(c[0].style.width=100*d+"%",c[0].style.height=100*f+"%"):E()),a=[1,1],o=a[0],i=a[1],v%180!==0&&(e=f/d*b,l=[e,1/e],o=l[0],i=l[1]),u[0].style.width=100*o+"%",u[0].style.height=100*i+"%",u[0].style.left=(1-o)/2*100+"%",u[0].style.top=(1-i)/2*100+"%",u.css({transform:"rotate("+v+"deg)"}),F(),z.angle=v,R()};o.rotateLeft=function(){j(-90)},o.rotateRight=function(){j(90)},o.center=function(){F()},o.fit=function(){E(),F()},o.zoomIn=function(){H(y)},o.zoomOut=function(){H(w),R()};var R=function(){e.crop(u[0],z,h.width,h.height).then(function(t){o.croppedImage=t})};u[0].onload=function(){var t=this;S(),W(u),(t.naturalWidth<h.width||t.naturalHeight<h.height||h.fitOnInit)&&E(),F(),r.find("img").on(x.start,I),R()};var W=function(e){return t.element(e).css({"-webkit-perspective":1e3,perspective:1e3,"-webkit-backface-visibility":"hidden","backface-visibility":"hidden"})}}return{restrict:"E",scope:{image:"@",destWidth:"@",destHeight:"@",zoomStep:"@",init:"@",croppedImage:"=",showControls:"=",fitOnInit:"=",restrictSize:"="},template:['<div class="frame">','<div class="imgCropper-window">','<div class="imgCropper-canvas">','<img ng-src="{{image}}">',"</div></div></div>",'<div id="controls" ng-if="showControls">','<button ng-click="rotateLeft()" type="button" title="Rotate left"> &lt; </button>','<button ng-click="zoomOut()" type="button" title="Zoom out"> - </button>','<button ng-click="fit()" type="button" title="Fit image"> [ ] </button>','<button ng-click="zoomIn()" type="button" title="Zoom in"> + </button>','<button ng-click="rotateRight()" type="button" title="Rotate right"> &gt; </button>',"</div>"].join(""),link:o}}t.module("imageCropper").directive("imageCropper",e),e.$inject=["Cropper","defaultConfig","Helper"]}(angular);